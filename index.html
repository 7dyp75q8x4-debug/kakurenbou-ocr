<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªå®Œå…¨ç‰ˆ</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #000;
}

/* ã‚«ãƒ¡ãƒ©æ˜ åƒï¼ˆå³ã®UIåˆ†ã ã‘å¹…ã‚’æ®‹ã™ï¼‰ */
#camera {
  position: absolute;
  top: 0;
  left: 0;
  width: calc(100vw - 260px);
  height: 100vh;
  object-fit: cover;
  background: #000;
}

/* å³å´ UI ãƒ‘ãƒãƒ« */
#ui-panel {
  position: absolute;
  top: 0;
  right: 0;
  width: 260px;
  height: 100vh;
  background: #111;
  color: #fff;
  padding: 12px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  gap: 12px;
  overflow-y: auto;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
#statusDisplay {
  background: #1e3cff;
  color: white;
  padding: 14px;
  text-align: center;
  border-radius: 8px;
  font-size: 20px;
}

/* ãƒœã‚¿ãƒ³ */
.mode-btn, #shootBtn {
  width: 100%;
  height: 100px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 14px;
  font-size: 20px;
}

#shootBtn {
  background: #c22;
}

/* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
#resultBox {
  background: #222;
  padding: 10px;
  border-radius: 8px;
}

.section-title {
  font-size: 18px;
  margin-bottom: 6px;
  border-bottom: 1px solid #555;
  padding-bottom: 4px;
}
</style>
</head>
<body>

<!-- ã‚«ãƒ¡ãƒ©æ˜ åƒ -->
<video id="camera" autoplay playsinline muted></video>

<!-- UI ãƒ‘ãƒãƒ« -->
<div id="ui-panel">

  <div id="statusDisplay">å¾…æ©Ÿä¸­</div>

  <button class="mode-btn" onclick="setMode('topic')">ğŸ“¸ ãŠé¡Œæ’®å½±</button>
  <button class="mode-btn" onclick="setMode('search')">ğŸ” ã‚«ãƒ¼ãƒ‰æ¢ç´¢</button>

  <button id="shootBtn"
    onmousedown="startHold()" onmouseup="stopHold()"
    ontouchstart="startHold()" ontouchend="stopHold()">
    ğŸ“¸ é•·æŠ¼ã—æ’®å½±
  </button>

  <div id="resultBox">
    <div class="section-title">ğŸ“˜ èª­ã¿å–ã£ãŸãŠé¡Œ</div>
    <div id="topicText">ï¼ˆã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼‰</div>

    <div class="section-title" style="margin-top:12px;">ğŸ† ã‚«ãƒ¼ãƒ‰æ¢ç´¢å€™è£œTOP3</div>
    <div id="candidates">
      1ä½: ãƒ¼<br>
      2ä½: ãƒ¼<br>
      3ä½: ãƒ¼
    </div>
  </div>

</div>

<script>
let stream = null;
let holding = false;
let holdTimer = null;
let mode = "topic";

/* --------------------
   ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆçœŸã£æš—å¯¾ç­–æ¸ˆï¼‰
--------------------- */
async function startCamera() {
  if (stream) {
    stream.getTracks().forEach(t => t.stop());
  }

  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: { exact: "environment" },
        width: { ideal: 1920 },
        height: { ideal: 1080 }
      },
      audio: false
    });

    const video = document.getElementById("camera");
    video.srcObject = stream;

  } catch (err) {
    console.error("ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼:", err);
    alert("ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã§ãã¾ã›ã‚“ã€‚\nè¨­å®šã‹ã‚‰ã‚«ãƒ¡ãƒ©è¨±å¯ã‚’ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„ã€‚");
  }
}
startCamera();

/* --------------------
   ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
--------------------- */
function setMode(newMode) {
  mode = newMode;
  document.getElementById("statusDisplay").textContent = "å¾…æ©Ÿä¸­";
}

/* --------------------
   é•·æŠ¼ã—æ’®å½±
--------------------- */
function startHold() {
  holding = true;
  document.getElementById("statusDisplay").textContent = "æ’®å½±ä¸­â€¦";

  holdTimer = setTimeout(() => {
    if (holding) captureFrame();
  }, 500); // 0.5ç§’ä»¥ä¸Šé•·æŠ¼ã—ã§æ’®å½±
}

function stopHold() {
  holding = false;
  clearTimeout(holdTimer);
  document.getElementById("statusDisplay").textContent = "å¾…æ©Ÿä¸­";
}

/* --------------------
   æ’®å½± â†’ OCR ã‚„è§£æã¸
--------------------- */
function captureFrame() {
  const video = document.getElementById("camera");

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  const imageData = canvas.toDataURL("image/jpeg");

  console.log("æ’®å½±ã—ã¾ã—ãŸ:", imageData);

  // ä»®ã®è¡¨ç¤ºï¼ˆæœ¬ç•ªã¯ OCR â†’ çµæœã‚’ã“ã“ã«è¡¨ç¤ºï¼‰
  if (mode === "topic") {
    document.getElementById("topicText").textContent = "ï¼ˆä¾‹ï¼‰æ’®å½±ã•ã‚ŒãŸãŠé¡Œãƒ†ã‚­ã‚¹ãƒˆ";
  } else {
    document.getElementById("candidates").innerHTML =
      "1ä½: å€™è£œA<br>2ä½: å€™è£œB<br>3ä½: å€™è£œC";
  }
}
</script>
</body>
</html>
