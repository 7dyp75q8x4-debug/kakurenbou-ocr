<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>数字検出カメラ</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #222;
    color: white;
    display: flex;
    flex-direction: row;
    height: 100vh;
}

/* 左側：検出画像一覧 */
#leftArea {
    width: 65%;
    padding: 10px;
    overflow-y: scroll;
}

#detectedList img {
    width: 180px;
    margin: 8px;
    border: 2px solid white;
    display: block;
}

/* 右側：入力 → カメラ → ボタン */
#rightArea {
    width: 35%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
}

/* 数字入力バー */
#targetNumber {
    width: 100%;
    font-size: 30px;
    padding: 10px;
    margin-bottom: 12px;
    box-sizing: border-box;
}

/* カメラエリア */
#cameraWrapper {
    width: 100%;
    aspect-ratio: 16 / 9;
    background: black;
}

#camera {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* 撮影ボタン（完全に画像） */
#shootBtnImg {
    width: 110px;
    height: 110px;
    margin-top: 15px;
    user-select: none;
}

/* 撮影ステータス */
#status {
    margin-top: 10px;
    font-size: 22px;
    color: #0f0;
}
</style>
</head>

<body>

<!-- 左側：検出された候補 -->
<div id="leftArea">
    <h2>検出候補</h2>
    <div id="detectedList"></div>
</div>

<!-- 右側：数字入力 → カメラ → 撮影ボタン -->
<div id="rightArea">

    <!-- ★ 数字入力バー（再追加＋確実表示） -->
    <input id="targetNumber" type="text" maxlength="3" placeholder="検索したい3桁の数字">

    <div id="cameraWrapper">
        <video id="camera" autoplay playsinline></video>
    </div>

    <!-- ★ 撮影ボタンを完全に画像へ置換（Base64 PNG） -->
    <img id="shootBtnImg"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAGFBMVEX///8AAAB/f3+Pj4+fn5+ampq9vb3e3t6YmJjbbxO2AAABRUlEQVR4nO3VwQmDMBAF0Tqt/59zsIwoMvVJE9idh+NEnNh4tW7GRMdmNAIAAAAAAAAAAAAAAAAAAAAAgGkeN+NW/BzxubAE8VZwOu30GPV1i/HHPNVrku1rpxjQtdz6HYjm+rXHzvtZlBnvzOYBG2sCvA8fse2D3QzvKKr37H1P0uohs9S7sEBvtq+G4N1N2/5pZjnr8ZVrTtcb7mPHVLujm91nBnYr4eMc3p/ACf5o+96Dvew2X5O45lsP7b9y67YTW/VXW4k93Z2+O+sCMf1EOWrEHhVxC4V8QuFfELhXxC4V8QuFfELhXxC4t2JfA9r8AlT3t3Tm9/qwAAAAASUVORK5CYII=">

    <div id="status"></div>
</div>

<script>
const video = document.getElementById("camera");
const detectedList = document.getElementById("detectedList");
const shootBtnImg = document.getElementById("shootBtnImg");
const statusLabel = document.getElementById("status");
const numberInput = document.getElementById("targetNumber");

// 外カメラ固定
navigator.mediaDevices.getUserMedia({
    video: { facingMode: { exact: "environment" } }
}).then(stream => {
    video.srcObject = stream;
});

// キャプチャ
function captureFrame() {
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);
    return canvas;
}

// トリミング（仮：中央領域）
function extractNumberArea(canvas) {
    const trimWidth = canvas.width * 0.25;
    const trimHeight = canvas.height * 0.16;
    const x = (canvas.width - trimWidth) / 2;
    const y = canvas.height * 0.15;

    const cropCanvas = document.createElement("canvas");
    cropCanvas.width = trimWidth;
    cropCanvas.height = trimHeight;

    const cctx = cropCanvas.getContext("2d");
    cctx.drawImage(canvas, x, y, trimWidth, trimHeight, 0, 0, trimWidth, trimHeight);

    const img = document.createElement("img");
    img.src = cropCanvas.toDataURL("image/png");
    return img;
}

// 長押し連写
let shooting = false;
let shootInterval = null;

shootBtnImg.addEventListener("mousedown", () => {
    shooting = true;
    statusLabel.textContent = "撮影中…";

    shootInterval = setInterval(() => {
        const frame = captureFrame();
        const crop = extractNumberArea(frame);
        detectedList.appendChild(crop);
    }, 500);
});

document.addEventListener("mouseup", () => {
    shooting = false;
    statusLabel.textContent = "";
    clearInterval(shootInterval);
});
</script>

</body>
</html>
