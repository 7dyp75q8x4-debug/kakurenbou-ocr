<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>かくれんぼ OCR Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

<style>
body { background:#111; color:#fff; text-align:center; font-family:sans-serif; }
button { padding:10px 20px; margin:10px; font-size:18px; }
video { width:90%; max-width:600px; background:#000; }
</style>
</head>
<body>

<h1>かくれんぼ OCR Finder<br>(GitHub Pages版)</h1>

<button onclick="startCamera()">カメラを起動</button>
<button onclick="stopCamera()">停止</button>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<p id="result">（ここに認識結果が表示されます）</p>

<script>

let stream = null;

async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        document.getElementById("video").srcObject = stream;
    } catch (e) {
        alert("カメラが起動できません。HTTPS で開いているか確認してください。\n\n詳細:\n" + e);
    }
}

function stopCamera() {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
}

async function captureAndRecognize() {

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0);
    const imageData = canvas.toDataURL("image/png");

    const resultText = document.getElementById("result");
    resultText.innerHTML = "読み取り中…";

    const worker = await Tesseract.createWorker("jpn");

    const { data } = await worker.recognize(imageData);

    resultText.innerHTML = "結果: " + data.text;

    await worker.terminate();
}

// 3秒ごとに OCR 読み取り
setInterval(captureAndRecognize, 3000);

</script>
</body>
</html>
