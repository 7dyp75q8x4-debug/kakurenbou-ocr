<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ã‹ãã‚Œã‚“ã¼ OCR Finder (GitHub Pagesç‰ˆ)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    background: #111;
    color: #fff;
    text-align: center;
    font-family: sans-serif;
}
video {
    width: 90%;
    max-width: 600px;
    margin-top: 10px;
    border: 2px solid #555;
    border-radius: 10px;
}
button {
    font-size: 20px;
    padding: 10px 20px;
    margin: 15px;
    border-radius: 10px;
}
#result {
    margin-top: 20px;
    font-size: 22px;
    white-space: pre-wrap;
}
#errorBox {
    background: #222;
    padding: 10px;
    margin: 10px;
    border-radius: 8px;
    display: none;
}
</style>
</head>

<body>

<h1>ã‹ãã‚Œã‚“ã¼ OCR Finder<br>(GitHub Pagesç‰ˆ)</h1>

<button onclick="startCamera()">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•</button>
<button onclick="stopCamera()">åœæ­¢</button>

<div id="errorBox"></div>

<video id="video" autoplay playsinline></video>

<div id="result">(ã“ã“ã«èªè­˜çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™)</div>

<script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

<script>
let stream = null;
let video = document.getElementById("video");
let resultBox = document.getElementById("result");
let errorBox = document.getElementById("errorBox");

function showError(err) {
    errorBox.style.display = "block";
    errorBox.innerText = "ã‚¨ãƒ©ãƒ¼: " + err;
}

function hideError() {
    errorBox.style.display = "none";
}

/* ============================
   ğŸ“¸ å¤–ã‚«ãƒ¡ãƒ©ã‚’å„ªå…ˆã—ã¦èµ·å‹•ã™ã‚‹
   ============================ */
async function startCamera() {
    hideError();

    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: { ideal: "environment" },   // â† å¤–ã‚«ãƒ¡ãƒ©å„ªå…ˆ
                width: { ideal: 1280 },
                height: { ideal: 720 }
            },
            audio: false
        });

        video.srcObject = stream;

    } catch (error) {
        showError(error);
    }
}

function stopCamera() {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
}

/* ============================
   ğŸ“˜ OCR å‡¦ç†ï¼ˆã‚«ãƒ¡ãƒ©æ˜ åƒã‚’è§£æï¼‰
   ============================ */
setInterval(async () => {
    if (!video.srcObject) return;

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);

    try {
        const worker = await Tesseract.createWorker("jpn");
        const ret = await worker.recognize(canvas);
        await worker.terminate();

        resultBox.innerText = ret.data.text;

    } catch (e) {
        showError(e);
    }
}, 2500);

</script>

</body>
</html>
