<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‹ãã‚Œã‚“ã¼OCR â€“ ã‚«ãƒ¡ãƒ©å®Ÿè£…ç‰ˆ</title>
<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        font-family: sans-serif;
        overflow: hidden;
    }

    .container {
        display: flex;
        flex-direction: row;
        height: 100vh;
        width: 100vw;
    }

    /* ã‚«ãƒ¡ãƒ©ã‚¨ãƒªã‚¢ */
    #cameraArea {
        flex: 2;
        background: #000;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    video {
        width: 100%;
        height: 100%;
        object-fit: cover; /* æ¨ªç”»é¢ã«ãƒ•ã‚£ãƒƒãƒˆ */
        transform: scaleX(-1); /* ãƒŸãƒ©ãƒ¼OFF â†’ å¾Œè¿°ã§åˆ‡ã‚Šæ›¿ãˆå¯ */
    }

    /* å³å´ã®æ“ä½œã‚¨ãƒªã‚¢ */
    #controlArea {
        flex: 1;
        background: #333;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    button {
        padding: 20px;
        font-size: 2vw;
        border-radius: 10px;
        border: none;
        background: #555;
        color: white;
    }

    #modeDisplay {
        font-size: 2.5vw;
        text-align: center;
        padding: 20px;
        background: #222;
    }

    #progress {
        font-size: 1.8vw;
        text-align: center;
    }
</style>
</head>
<body>

<div class="container">

    <div id="cameraArea">
        <video id="video" autoplay playsinline></video>
    </div>

    <div id="controlArea">

        <div id="modeDisplay">ç¾åœ¨ï¼šãŠé¡Œæ’®å½±ãƒ¢ãƒ¼ãƒ‰</div>

        <button onclick="setMode('odai')">ğŸ“¸ ãŠé¡Œæ’®å½±ãƒ¢ãƒ¼ãƒ‰</button>
        <button onclick="setMode('search')">ğŸ” ã‚«ãƒ¼ãƒ‰æ¢ç´¢ãƒ¢ãƒ¼ãƒ‰</button>
        <button onclick="setMode('cameraTest')">ğŸ¥ ã‚«ãƒ¡ãƒ©ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</button>

        <button id="startCapture">ğŸ”´ é•·æŠ¼ã—ã§æ’®å½±ï¼ˆã¾ã å‹•ä½œã—ã¾ã›ã‚“ï¼‰</button>

        <div id="progress">æ’®å½±å¾…æ©Ÿä¸­â€¦</div>
    </div>

</div>

<script>
let mode = "odai";
let stream = null;

/* ============================
   ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
============================ */
function setMode(newMode) {
    mode = newMode;

    const modeText = {
        "odai": "ç¾åœ¨ï¼šãŠé¡Œæ’®å½±ãƒ¢ãƒ¼ãƒ‰",
        "search": "ç¾åœ¨ï¼šã‚«ãƒ¼ãƒ‰æ¢ç´¢ãƒ¢ãƒ¼ãƒ‰",
        "cameraTest": "ç¾åœ¨ï¼šã‚«ãƒ¡ãƒ©ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰"
    };

    document.getElementById("modeDisplay").innerText = modeText[newMode];
}

/* ============================
   â˜… å¤–ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã™ã‚‹é–¢æ•°
============================ */
async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: { exact: "environment" }, // â˜… å¤–ã‚«ãƒ¡ãƒ©å¼·åˆ¶
                width: { ideal: 1920 },
                height: { ideal: 1080 }
            },
            audio: false
        });

        const video = document.getElementById("video");
        video.srcObject = stream;

        console.log("å¤–ã‚«ãƒ¡ãƒ©èµ·å‹•OK");

    } catch (e) {
        console.error("å¤–ã‚«ãƒ¡ãƒ©èµ·å‹•ã§ããš â†’ å†…ã‚«ãƒ¡ãƒ©ã¸ fallback", e);

        // fallbackï¼šå†…ã‚«ãƒ¡ãƒ©
        stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: false
        });

        document.getElementById("video").srcObject = stream;
    }
}

/* èµ·å‹•æ™‚ã«ã‚«ãƒ¡ãƒ©ON */
startCamera();
</script>

</body>
</html>
