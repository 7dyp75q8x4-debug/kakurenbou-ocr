<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>ã‹ãã‚Œã‚“ã¼ OCR â€” å®Œå…¨ç‰ˆ</title>
<!-- Tesseract.js CDN (v2.x) -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<style>
  :root{
    --bg:#0f0f10;
    --panel:#171717;
    --accent:#d32;
    --muted:#999;
    --primary:#1766ff;
    --ok:#0b8f4f;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
  /* Full-width landscape layout - no scroll */
  .app {
    display:grid;
    grid-template-columns: 160px 1fr 320px;
    grid-template-rows: 1fr;
    gap:14px;
    height:100vh;
    padding:14px;
    box-sizing:border-box;
    align-items:start;
  }

  /* LEFT: ODAI LIST */
  .left {
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:stretch;
  }
  .odai-slot {
    background:transparent;
    border:2px solid #991c1c;
    padding:8px;
    height:120px;
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:center;
    box-sizing:border-box;
    border-radius:8px;
  }
  .odai-label { writing-mode:horizontal-tb; font-size:20px; text-align:center; }
  .odai-image{
    width:220px;height:120px;object-fit:cover;border-radius:6px;border:1px solid #333;background:#111;
  }

  /* CENTER: CANDIDATES FOR EACH ODAI */
  .center {
    display:flex;
    flex-direction:column;
    gap:14px;
    padding-right:8px;
  }
  .odai-row{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .candidates {
    display:flex;
    gap:10px;
    flex-wrap:nowrap;
  }
  .cand-box{
    width:220px;height:120px;background:#121212;border:2px solid #222;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-direction:column;
  }
  .cand-box img{width:100%;height:100%;object-fit:cover;border-radius:6px}
  .cand-title{font-size:14px;color:var(--muted);margin-top:4px}

  /* RIGHT: CAMERA + CONTROLS */
  .right {
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:stretch;
    box-sizing:border-box;
  }
  .status {
    background:var(--panel);padding:12px;border-radius:10px;text-align:center;font-weight:700;color:var(--primary)
  }
  .controls {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
  }
  .btn {
    background:#2a2a2a;border-radius:8px;padding:12px;text-align:center;font-weight:700;border:1px solid #333;cursor:pointer;
  }
  .btn.shoot {background:#c93030;color:#fff}
  .btn.small{width:68px;height:68px;padding:0;display:flex;align-items:center;justify-content:center;border-radius:10px;font-size:18px}
  .camera-box {
    background:#0b0b0b;border-radius:10px;padding:10px;border:1px solid #222;display:flex;flex-direction:column;align-items:center;gap:8px;height:280px;box-sizing:border-box;
  }
  video#preview {
    width:100%; height:180px; background:#000; object-fit:cover;border-radius:8px;border:1px solid #222;
  }
  .log {
    position: absolute;
    right:12px;
    top:18px;
    width:320px;
    max-height:34vh;
    overflow:auto;
    backdrop-filter: blur(6px);
    background: rgba(10,10,12,0.6);
    border-radius:10px;
    padding:8px;
    border:1px solid rgba(255,255,255,0.04);
    font-size:12px;
    color:#fff;
  }
  .log p { margin:6px 0; font-family:monospace; font-size:12px; color:#eee; }
  .small-muted{color:var(--muted);font-size:12px}

  /* responsive small screens: still landscape assumption */
  @media(max-width:1100px){
    .app { grid-template-columns: 120px 1fr 260px; gap:8px; padding:8px; }
    .odai-slot{height:100px}
    .odai-image{width:180px;height:100px}
    .cand-box{width:180px;height:100px}
    .camera-box{height:220px}
    .log{width:260px}
  }
</style>
</head>
<body>
<div class="app">

  <!-- LEFT: 5 odai slots -->
  <div class="left" id="leftCol">
    <!-- each slot contains label + mini thumbnail placeholder -->
    <div class="odai-slot" data-index="0">
      <div class="odai-label">ãŠé¡Œ1<br><span class="small-muted" id="odai1num">æœªã‚»ãƒƒãƒˆ</span></div>
    </div>
    <div class="odai-slot" data-index="1">
      <div class="odai-label">ãŠé¡Œ2<br><span class="small-muted" id="odai2num">æœªã‚»ãƒƒãƒˆ</span></div>
    </div>
    <div class="odai-slot" data-index="2">
      <div class="odai-label">ãŠé¡Œ3<br><span class="small-muted" id="odai3num">æœªã‚»ãƒƒãƒˆ</span></div>
    </div>
    <div class="odai-slot" data-index="3">
      <div class="odai-label">ãŠé¡Œ4<br><span class="small-muted" id="odai4num">æœªã‚»ãƒƒãƒˆ</span></div>
    </div>
    <div class="odai-slot" data-index="4">
      <div class="odai-label">ãŠé¡Œ5<br><span class="small-muted" id="odai5num">æœªã‚»ãƒƒãƒˆ</span></div>
    </div>
  </div>

  <!-- CENTER: for each odai, candidates top3 -->
  <div class="center" id="centerCol">
    <!-- these rows align with left odai slots -->
    <div class="odai-row" data-index="0">
      <div style="width:12px"></div>
      <div class="candidates" id="cands-0">
        <div class="cand-box" id="odai0img"><div class="small-muted">æœªã‚»ãƒƒãƒˆ</div></div>
        <div class="cand-box" id="odai0c1"><div class="small-muted">å€™è£œ 1</div></div>
        <div class="cand-box" id="odai0c2"><div class="small-muted">å€™è£œ 2</div></div>
      </div>
    </div>

    <div class="odai-row" data-index="1">
      <div style="width:12px"></div>
      <div class="candidates" id="cands-1">
        <div class="cand-box" id="odai1img"><div class="small-muted">æœªã‚»ãƒƒãƒˆ</div></div>
        <div class="cand-box" id="odai1c1"><div class="small-muted">å€™è£œ 1</div></div>
        <div class="cand-box" id="odai1c2"><div class="small-muted">å€™è£œ 2</div></div>
      </div>
    </div>

    <div class="odai-row" data-index="2">
      <div style="width:12px"></div>
      <div class="candidates" id="cands-2">
        <div class="cand-box" id="odai2img"><div class="small-muted">æœªã‚»ãƒƒãƒˆ</div></div>
        <div class="cand-box" id="odai2c1"><div class="small-muted">å€™è£œ 1</div></div>
        <div class="cand-box" id="odai2c2"><div class="small-muted">å€™è£œ 2</div></div>
      </div>
    </div>

    <div class="odai-row" data-index="3">
      <div style="width:12px"></div>
      <div class="candidates" id="cands-3">
        <div class="cand-box" id="odai3img"><div class="small-muted">æœªã‚»ãƒƒãƒˆ</div></div>
        <div class="cand-box" id="odai3c1"><div class="small-muted">å€™è£œ 1</div></div>
        <div class="cand-box" id="odai3c2"><div class="small-muted">å€™è£œ 2</div></div>
      </div>
    </div>

    <div class="odai-row" data-index="4">
      <div style="width:12px"></div>
      <div class="candidates" id="cands-4">
        <div class="cand-box" id="odai4img"><div class="small-muted">æœªã‚»ãƒƒãƒˆ</div></div>
        <div class="cand-box" id="odai4c1"><div class="small-muted">å€™è£œ 1</div></div>
        <div class="cand-box" id="odai4c2"><div class="small-muted">å€™è£œ 2</div></div>
      </div>
    </div>

  </div>

  <!-- RIGHT: Controls + camera -->
  <div class="right">
    <div class="status" id="status">çŠ¶æ…‹ï¼š<span id="statusText" style="color:var(--primary)">å¾…æ©Ÿä¸­</span></div>

    <div class="controls" style="margin-bottom:6px">
      <div class="btn" id="modeOdai">ğŸ“· ãŠé¡Œæ’®å½±ãƒ¢ãƒ¼ãƒ‰</div>
      <div class="btn" id="modeSearch">ğŸ” ç•ªå·æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰</div>
      <div class="btn small" id="btnReset" title="ãŠé¡Œãƒªã‚»ãƒƒãƒˆ">â™»</div>
      <div class="btn shoot small" id="btnLong">â—</div>
    </div>

    <div class="camera-box">
      <video id="preview" autoplay playsinline muted></video>
      <div class="small-muted">ã‚«ãƒ¡ãƒ©ï¼ˆå°ï¼‰</div>
      <div style="display:flex;gap:8px;margin-top:6px;">
        <div class="small-muted">æ’®å½±æšæ•°: <span id="framesCount">0</span></div>
        <div style="flex:1"></div>
      </div>
      <div style="height:8px"></div>
      <div class="small-muted">â€»é•·æŠ¼ã—ã§é€£å†™ï¼ˆ1ç§’ã”ã¨ã€æœ€å¤§10æšï¼‰</div>
    </div>
  </div>

</div>

<!-- small log overlay -->
<div class="log" id="logBox" aria-live="polite"></div>

<script>
/*
  å®Œå…¨ç‰ˆ HTML/JS
  - Tesseract.js v2 ã‚’ CDN ã§èª­ã¿è¾¼ã¿ (script tag ä¸Šéƒ¨)
  - ã‚«ãƒ¡ãƒ©èµ·å‹•ã€é•·æŠ¼ã—ã§é€£å†™ï¼ˆ1ç§’é–“éš”ï¼‰
  - ãŠé¡Œãƒ¢ãƒ¼ãƒ‰: OCR ã§ 3æ¡ã‚’æ¤œå‡º â†’ å·¦åˆ—ã«è‡ªå‹•ã‚»ãƒƒãƒˆï¼ˆé‡è¤‡ã—ãªã„ï¼‰
  - ç•ªå·æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰: OCR ã§æ•°å­—åˆ—ã‚’æ¤œå‡º â†’ ä¸­åˆ—å€™è£œã«è¿½åŠ ï¼ˆç°¡æ˜“ï¼‰
  - èµ¤ã„æ ï¼ˆæ¤œå‡ºã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ã¯è¡¨ç¤ºã—ãªã„ï¼ˆå‰Šé™¤ï¼‰
*/

const video = document.getElementById('preview');
const statusText = document.getElementById('statusText');
const logBox = document.getElementById('logBox');
const framesCountEl = document.getElementById('framesCount');

let stream = null;
let captureTimer = null;
let captureCount = 0;
let maxCapture = 10;
let currentMode = 'odai'; // 'odai' or 'search'
let usedNumbers = new Set();
let odaiSetOrder = []; // stores numbers in order set
let tesseractWorker = null;
let ocrBusy = false;

// utility: append log with timestamp
function log(msg){
  const t = new Date().toLocaleTimeString();
  const p = document.createElement('p');
  p.textContent = `[${t}] ${msg}`;
  logBox.prepend(p);
  // keep limited
  while(logBox.childElementCount > 200) logBox.removeChild(logBox.lastChild);
}

// update status color
function setStatus(state){
  // state: 'idle'|'capturing'
  if(state === 'idle'){ statusText.textContent = 'å¾…æ©Ÿä¸­'; statusText.style.color='var(--primary)'; }
  else { statusText.textContent = 'æ’®å½±ä¸­'; statusText.style.color='red'; }
}

// init camera
async function startCamera(){
  try{
    if(stream){ return; }
    // prefer environment (back) camera
    stream = await navigator.mediaDevices.getUserMedia({
      audio:false,
      video: { facingMode: { ideal: "environment" }, width: {ideal:1280}, height:{ideal:720} }
    });
    video.srcObject = stream;
    await video.play();
    log('ã‚«ãƒ¡ãƒ©èµ·å‹•: OK');
  }catch(e){
    console.error(e);
    log('ã‚«ãƒ¡ãƒ©èµ·å‹•ã«å¤±æ•—: ' + e.message);
    alert('ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã§ãã¾ã›ã‚“ã€‚HTTPSã§é–‹ã„ã¦ã„ã‚‹ã‹ã€ã‚«ãƒ¡ãƒ©ã®è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
  }
}

// stop camera if needed
function stopCamera(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    stream = null;
    log('ã‚«ãƒ¡ãƒ©åœæ­¢');
  }
}

// capture current video frame -> dataURL
function captureFrameDataURL(){
  const w = video.videoWidth;
  const h = video.videoHeight;
  const canvas = document.createElement('canvas');
  // we'll scale down to reduce OCR load but keep resolution
  const scale = Math.min(1, 1280 / Math.max(w,h));
  canvas.width = Math.round(w * scale);
  canvas.height = Math.round(h * scale);
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  return canvas.toDataURL('image/jpeg', 0.9);
}

// OCR using tesseract (extract numbers)
async function runOCRImageDataURL(dataURL){
  if(!window.Tesseract){
    log('OCRãƒ©ã‚¤ãƒ–ãƒ©ãƒª(Tesseract.js)ãŒæœªãƒ­ãƒ¼ãƒ‰ã§ã™ã€‚');
    return '';
  }
  if(ocrBusy){
    log('OCR å‡¦ç†ä¸­ã«ã¤ãã‚¹ã‚­ãƒƒãƒ—');
    return '';
  }
  ocrBusy = true;
  try{
    log('OCRé–‹å§‹...');
    // choose english digits recognition -- we infer digits better with "eng"
    let res = await Tesseract.recognize(dataURL, 'eng', {
      tessjs_create_pdf: '0'
    });
    const text = res.data && res.data.text ? res.data.text : '';
    log('OCR å®Œäº†ã€‚ãƒ†ã‚­ã‚¹ãƒˆé•·: ' + text.length);
    return text;
  }catch(e){
    console.error(e);
    log('OCR ã‚¨ãƒ©ãƒ¼: ' + e.message);
    return '';
  } finally {
    ocrBusy = false;
  }
}

// find 3-digit numbers in text
function extractThreeDigits(text){
  // match \b\d{3}\b
  const re = /\b(\d{3})\b/g;
  const out = [];
  let m;
  while((m=re.exec(text)) !== null){
    out.push(m[1]);
    if(out.length>=10) break;
  }
  return out;
}

// set odai into next available slot (if not duplicate)
function setOdaiNumber(num, imageDataURL){
  if(usedNumbers.has(num)){
    log(`é‡è¤‡: ${num} ã¯æ—¢ã«ã‚»ãƒƒãƒˆæ¸ˆã¿ã€‚`);
    return false;
  }
  if(odaiSetOrder.length >= 5){
    log('ãŠé¡Œã‚¹ãƒ­ãƒƒãƒˆãŒæº€æ¯ã§ã™ï¼ˆ5ï¼‰ã€‚');
    return false;
  }
  const idx = odaiSetOrder.length;
  usedNumbers.add(num);
  odaiSetOrder.push(num);
  // set left label
  const label = document.querySelector(`#leftCol .odai-slot[data-index="${idx}"] .odai-label`);
  if(label){
    label.innerHTML = `ãŠé¡Œ${idx+1}<br><span class="small-muted">${num}</span>`;
  }
  // set center main image
  const mainBox = document.getElementById(`odai${idx}img`);
  if(mainBox){
    mainBox.innerHTML = `<img src="${imageDataURL}" alt="odai${idx}">`;
  }
  log(`[ãŠé¡Œãƒ¢ãƒ¼ãƒ‰] ãŠé¡Œã‚»ãƒƒãƒˆæ¸ˆ: index=${idx}, num=${num}`);
  return true;
}

// add candidate for a specific odai index (append to c1/c2 in sequence)
function addCandidateForOdai(index, candidateImage, num){
  const candKeys = [`odai${index}c1`,`odai${index}c2`];
  for(const k of candKeys){
    const el = document.getElementById(k);
    if(el){
      // if placeholder (no img), set it
      if(!el.querySelector('img')){
        el.innerHTML = `<img src="${candidateImage}" alt="cand" /><div class="cand-title">å€™è£œ: ${num}</div>`;
        return true;
      }
    }
  }
  // if both filled, overwrite the second slot (simple LRU)
  const el2 = document.getElementById(`odai${index}c2`);
  if(el2){
    el2.innerHTML = `<img src="${candidateImage}" alt="cand" /><div class="cand-title">å€™è£œ: ${num}</div>`;
    return true;
  }
  return false;
}

// Button and long-press logic
const modeOdaiBtn = document.getElementById('modeOdai');
const modeSearchBtn = document.getElementById('modeSearch');
const btnLong = document.getElementById('btnLong');
const btnReset = document.getElementById('btnReset');

modeOdaiBtn.addEventListener('click', ()=>{ currentMode='odai'; modeOdaiBtn.style.border='2px solid #888'; modeSearchBtn.style.border='1px solid #333'; log('ãƒ¢ãƒ¼ãƒ‰: ãŠé¡Œæ’®å½±ãƒ¢ãƒ¼ãƒ‰'); });
modeSearchBtn.addEventListener('click', ()=>{ currentMode='search'; modeSearchBtn.style.border='2px solid #888'; modeOdaiBtn.style.border='1px solid #333'; log('ãƒ¢ãƒ¼ãƒ‰: ç•ªå·æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰'); });
btnReset.addEventListener('click', ()=>{ resetOdai(); });

function resetOdai(){
  usedNumbers.clear();
  odaiSetOrder = [];
  // clear UI
  for(let i=0;i<5;i++){
    const label = document.querySelector(`#leftCol .odai-slot[data-index="${i}"] .odai-label`);
    if(label) label.innerHTML = `ãŠé¡Œ${i+1}<br><span class="small-muted">æœªã‚»ãƒƒãƒˆ</span>`;
    // clear images
    ['img','c1','c2'].forEach(k=>{
      const el = document.getElementById(`odai${i}${k==='img'?'img':(k==='c1'?'c1':'c2')}`);
      if(el) el.innerHTML = `<div class="small-muted">æœªã‚»ãƒƒãƒˆ</div>`;
    });
  }
  log('ãŠé¡Œãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ');
}

// long press capture (touch/mouse)
let pressTimer = null;
let capturing = false;

function startLongPress(){
  if(capturing) return;
  capturing = true;
  captureCount = 0;
  framesCountEl.textContent = '0';
  setStatus('capturing');
  log('é•·æŠ¼ã—æ’®å½± é–‹å§‹');
  // start loop: every 1000ms capture a frame, up to maxCapture
  captureTimer = setInterval(async ()=>{
    if(captureCount >= maxCapture){
      stopLongPress();
      return;
    }
    await captureOneFrameAndProcess();
    captureCount++;
    framesCountEl.textContent = captureCount;
  }, 1000);
}

function stopLongPress(){
  if(!capturing) return;
  capturing = false;
  if(captureTimer) { clearInterval(captureTimer); captureTimer = null; }
  setStatus('idle');
  log(`[æ’®å½±] é•·æŠ¼ã—çµ‚äº†ã€‚å–å¾—æšæ•°: ${captureCount}`);
}

btnLong.addEventListener('mousedown', (e)=>{ e.preventDefault(); startLongPress(); });
btnLong.addEventListener('touchstart', (e)=>{ e.preventDefault(); startLongPress(); }, {passive:false});
document.addEventListener('mouseup', ()=> stopLongPress());
document.addEventListener('touchend', ()=> stopLongPress());

// one frame capture and process depending on current mode
async function captureOneFrameAndProcess(){
  const dataURL = captureFrameDataURL();
  log('ãƒ•ãƒ¬ãƒ¼ãƒ å–å¾—');
  if(currentMode === 'odai'){
    // OCR expecting 3-digit numbers
    const text = await runOCRImageDataURL(dataURL);
    const nums = extractThreeDigits(text);
    if(nums.length === 0){
      log('[ãŠé¡Œãƒ¢ãƒ¼ãƒ‰] 3æ¡ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
      return;
    }
    // pick first unseen number
    let found = false;
    for(const n of nums){
      if(!usedNumbers.has(n)){
        const ok = setOdaiNumber(n, dataURL);
        if(ok) found = true;
        break;
      }
    }
    if(!found){ log('[ãŠé¡Œãƒ¢ãƒ¼ãƒ‰] æ–°ã—ã„æœªç™»éŒ²ã®3æ¡ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ'); }
  } else {
    // search mode: extract numbers and add as candidates to appropriate odai
    const text = await runOCRImageDataURL(dataURL);
    const nums = extractThreeDigits(text);
    if(nums.length === 0){ log('[æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰] æ•°å­—ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ'); return; }
    // make frequency map and sort by count
    const freq = {};
    nums.forEach(n => freq[n] = (freq[n]||0)+1);
    const sorted = Object.keys(freq).sort((a,b)=>freq[b]-freq[a]);
    // We'll attach top candidates to odai slots in order of existing odaiSetOrder
    // If no odai set yet, place candidates to the first slot(s) which are not set
    if(odaiSetOrder.length === 0){
      log('[æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰] ã¾ã ãŠé¡Œæœªã‚»ãƒƒãƒˆã€‚æ¤œå‡ºç•ªå·ã‚’ãƒ­ã‚°ã§è¡¨ç¤º: ' + sorted.slice(0,5).join(', '));
      // show detected numbers in log
      sorted.slice(0,5).forEach((n,i)=> log(`[æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰] æ¤œå‡º: ${n} (count=${freq[n]})`));
      return;
    }
    // For each number, try to match to odai slots: if number equals an odai number, place candidate next to it
    let assigned = 0;
    for(const n of sorted){
      const slotIndex = odaiSetOrder.indexOf(n);
      if(slotIndex >= 0){
        addCandidateForOdai(slotIndex, dataURL, n);
        assigned++;
        log(`[æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰] å€™è£œè¿½åŠ : odaiIndex=${slotIndex}, num=${n}`);
      }
      if(assigned >= 6) break;
    }
    // If none matched odai numbers, add to first odai's candidates as fallback
    if(assigned === 0){
      addCandidateForOdai(0, dataURL, sorted[0]);
      log(`[æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãŠé¡Œ1ã®å€™è£œã«è¿½åŠ : ${sorted[0]}`);
    }
  }
}

// Initialize Tesseract worker (v2 provides global Tesseract)
async function ensureOCR(){
  if(window.Tesseract) {
    log('Tesseract.js èª­ã¿è¾¼ã¿æ¸ˆã¿');
    return;
  }
  // else: it should be loaded via script tag. If not, user must add it.
  log('Tesseract.js ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚OCRã¯ä½¿ãˆã¾ã›ã‚“ã€‚');
}

// Start camera on load
(async function init(){
  await ensureOCR();
  await startCamera();
  setStatus('idle');
  log('UI åˆæœŸåŒ–å®Œäº†');
})();

// Remove any "red window" overlay if existed in older versions (compatibility)
(function removeRedWindowIfExists(){
  const red = document.querySelectorAll('.detect-window, .red-window, #redWindow');
  red.forEach(r=>r.style.display='none');
  // Also remove inline canvas overlays by id if present
  const oldCanvas = document.getElementById('overlayCanvas');
  if(oldCanvas) oldCanvas.style.display='none';
  log('èµ¤ã„æ¤œå‡ºæ ã‚’éè¡¨ç¤ºã«ã—ã¾ã—ãŸï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰');
})();

</script>
</body>
</html>
