<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>ã‚«ãƒ¼ãƒ‰æ¢ç´¢ã‚«ãƒ¡ãƒ©</title>

<style>
  body{
    margin:0; padding:0; background:#000; color:#fff;
    font-family: -apple-system, system-ui;
    overflow:hidden; /* â† ã‚¹ãƒ¯ã‚¤ãƒ—ç¦æ­¢ */
  }

  #wrap{
    display:flex;
    flex-direction:column;
    width:100vw;
    height:100vh;
    padding:8px;
    gap:6px;
    box-sizing:border-box;
  }

  /* ğŸ”µ ã‚«ãƒ¡ãƒ©ï¼šå°å‹åŒ–ã—ã¦ã‚‚é»’ç”»é¢ã«ãªã‚‰ãªã„é™ç•Œå€¤ */
  #cameraBox{
    width:150px;
    height:95px;
    background:#111;
    border-radius:10px;
    border:2px solid #333;
    overflow:hidden;
    flex-shrink:0;
  }
  #camera{
    width:100%;
    height:100%;
    object-fit:cover;
    background:#000;
  }

  /* ğŸŸ¦ çŠ¶æ…‹è¡¨ç¤ºï¼ˆå¾…æ©Ÿä¸­ / æ’®å½±ä¸­ï¼‰ */
  #status{
    padding:6px;
    text-align:center;
    font-size:18px;
    font-weight:bold;
    background:#1e3cff;
    border-radius:10px;
    flex-shrink:0;
  }

  /* ğŸ› ãƒœã‚¿ãƒ³4ã¤ã‚’1åˆ—ã« */
  #btnRow{
    display:flex;
    gap:6px;
    flex-shrink:0;
  }
  .sqBtn{
    width:55px;
    height:55px;
    font-size:25px;
    background:#333;
    border-radius:10px;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  #shootBtn{ background:#b11; }

  /* ğŸ”¶ æƒ…å ±ãƒ‘ãƒãƒ«ï¼ˆé«˜ã•å¯å¤‰ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ï¼‰ */
  #infoPanel{
    flex:1;
    background:#111;
    border-radius:10px;
    padding:10px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .box{
    background:#222;
    padding:10px;
    border-radius:8px;
    font-size:20px;
    line-height:1.2em;
  }

</style>
</head>
<body>

<div id="wrap">

  <!-- ğŸ“· ã‚«ãƒ¡ãƒ©ãƒœãƒƒã‚¯ã‚¹ -->
  <div id="cameraBox">
    <video id="camera" autoplay playsinline></video>
  </div>

  <!-- ğŸŸ¦ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
  <div id="status">å¾…æ©Ÿä¸­</div>

  <!-- ğŸ› ãƒœã‚¿ãƒ³ -->
  <div id="btnRow">
    <div class="sqBtn" id="btnOni">ğŸ“¸</div>
    <div class="sqBtn" id="btnSearch">ğŸ”</div>
    <div class="sqBtn" id="btnReset">â™»ï¸</div>
    <div class="sqBtn" id="shootBtn">â—</div>
  </div>

  <!-- ğŸ“ æƒ…å ±ãƒ‘ãƒãƒ«ï¼ˆãŠé¡Œ & å€™è£œTOP3ï¼‰ -->
  <div id="infoPanel">
    <div class="box">
      <b>ãŠé¡Œï¼ˆ3æ¡ï¼‰ï¼š</b><br>
      <span id="odai">â€•</span>
    </div>
    <div class="box">
      <b>å€™è£œ TOP3ï¼š</b><br>
      <span id="top1">â€•</span><br>
      <span id="top2">â€•</span><br>
      <span id="top3">â€•</span>
    </div>
  </div>

</div>

<script>
/* =====================
   ğŸ“· ã‚«ãƒ¡ãƒ©èµ·å‹•å‡¦ç†
===================== */
async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{
        facingMode:"environment",
        width:{ideal:640},
        height:{ideal:480}
      },
      audio:false
    });
    const cam = document.getElementById("camera");
    cam.srcObject = stream;
  }catch(e){
    console.log("ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼:", e);
  }
}
startCamera();

/* =====================
   ğŸ¦ é•·æŠ¼ã—æ’®å½±å‡¦ç†
===================== */
let shootTimer = null;
const shootBtn = document.getElementById("shootBtn");
const statusBar = document.getElementById("status");

shootBtn.addEventListener("touchstart", () => {
  statusBar.textContent = "æ’®å½±ä¸­";
  statusBar.style.background = "#ff3333";

  shootTimer = setTimeout(()=>{
    captureImage();
  }, 800); // é•·æŠ¼ã— 0.8ç§’
});

shootBtn.addEventListener("touchend", () => {
  clearTimeout(shootTimer);
  statusBar.textContent = "å¾…æ©Ÿä¸­";
  statusBar.style.background = "#1e3cff";
});

/* =====================
   ğŸ“¸ æ’®å½±ã—ã¦ç”»åƒãƒ‡ãƒ¼ã‚¿å–å¾—
===================== */
function captureImage(){
  const video = document.getElementById("camera");
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  const imgData = canvas.toDataURL("image/jpeg");

  // å®Ÿéš›ã¯OCRå‡¦ç†ã¸é€ä¿¡ã™ã‚‹éƒ¨åˆ†
  console.log("æ’®å½±ãƒ‡ãƒ¼ã‚¿:", imgData);

  // ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ©ãƒ³ãƒ€ãƒ åæ˜ 
  document.getElementById("odai").textContent = String(Math.floor(Math.random()*900+100));
  document.getElementById("top1").textContent = "å€™è£œ1";
  document.getElementById("top2").textContent = "å€™è£œ2";
  document.getElementById("top3").textContent = "å€™è£œ3";
}

</script>

</body>
</html>
