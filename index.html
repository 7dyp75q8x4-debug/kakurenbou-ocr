<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‹ãã‚Œã‚“ã¼ OCR Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    background: #111;
    color: #fff;
    text-align: center;
    font-family: sans-serif;
}
video {
    width: 90%;
    max-width: 600px;
    margin-top: 10px;
    border: 2px solid #555;
    border-radius: 10px;
}
button {
    font-size: 20px;
    padding: 10px 20px;
    margin: 15px;
    border-radius: 10px;
}
#errorBox {
    display: none;
    background: #300;
    padding: 10px;
    margin: 10px;
    border-radius: 8px;
}
</style>
</head>

<body>

<h1>ã‹ãã‚Œã‚“ã¼ OCR Finder</h1>

<button onclick="startCamera()">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ï¼ˆèƒŒé¢å›ºå®šï¼‰</button>
<button onclick="stopCamera()">åœæ­¢</button>

<div id="errorBox"></div>

<video id="video" autoplay playsinline></video>

<script>
let stream = null;
const video = document.getElementById("video");
const errorBox = document.getElementById("errorBox");

function showError(err) {
    errorBox.style.display = "block";
    errorBox.innerText = "ã‚¨ãƒ©ãƒ¼: " + err;
}

// ================================
// ğŸš€ å¤–ã‚«ãƒ¡ãƒ©ã‚’å¼·åˆ¶ã§èµ·å‹•ã™ã‚‹é–¢æ•°
// ================================
async function startCamera() {
    try {
        // â‘  ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã‚’å–å¾—
        const devices = await navigator.mediaDevices.enumerateDevices();

        // â‘¡ èƒŒé¢ã‚«ãƒ¡ãƒ©(â€œbackâ€ â€œenvironmentâ€)ã‚’æ¤œç´¢
        let backCameraId = null;
        devices.forEach(d => {
            if (d.kind === "videoinput") {
                const label = d.label.toLowerCase();
                if (label.includes("back") || label.includes("environment")) {
                    backCameraId = d.deviceId;
                }
            }
        });

        // â‘¢ è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã° facingMode ã‚’ä½¿ã†
        let constraints = null;
        if (backCameraId) {
            constraints = {
                video: {
                    deviceId: { exact: backCameraId },
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };
        } else {
            constraints = {
                video: {
                    facingMode: { ideal: "environment" },
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };
        }

        // â‘£ ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•
        stream = await navigator.mediaDevices.getUserMedia(constraints);

        video.srcObject = stream;

    } catch (err) {
        showError(err);
    }
}

function stopCamera() {
    if (stream) {
        stream.getTracks().forEach(t => t.stop());
    }
}
</script>

</body>
</html>
